--Retrieve the titles and publication years of all books published after 2000, ordered by publication year (newest first).
SELECT title, publication_year from Books
WHERE Publication_year> 2000
ORDER BY publication_year DESC;

--Find all books with more than 5 copies owned in the fiction genre (genre_id = 1).
SELECT * from Books 
WHERE copies_owned >5
AND genre_id = 1;

--List all books whose titles contain the word "History".
SELECT * from Books 
WHERE title LIKE '%History%';

--Display loan information (loan_id, checkout_date, due_date) along with patron details (first_name, last_name, email) for all loans made in January 2023.
SELECT l.loan_id, l.checkout_date, l.due_date, 
p.first_name, p.last_name, p.email
from Loans as l
JOIN Patrons as p
ON l.patron_id = p.patron_id
WHERE checkout_date >= '2023-01-01'
  AND checkout_date < '2023-02-01';
  
--Show book details (title, author's full name, genre_name) for each loan, along with the checkout_date and due_date.
SELECT b.title, a.first_name||' '||last_name as Author_full_name, g.genre_name,
l.checkout_date, l.due_date
from Loans as l
JOIN Books as b 
ON l.book_id = b.book_id
JOIN Authors as a
ON a.author_id = b.author_id
JOIN Genres as g
ON g.genre_id = b.genre_id;

-- Find pairs of patrons who live in the same city. Show both patrons' names and their city.
SELECT 
p1.first_name || ' ' || p1.last_name as patron_1,
p2.first_name || ' ' || p2.last_name as patron_2,
p2.city 
from Patrons as p1
JOIN Patrons as p2
ON p1.city = p2.city
AND p1.patron_id < p2.patron_id;

--Find all fiction books (genre_id = 1) that have been borrowed, along with the patron name and the branch where they were borrowed from.
SELECT b.title, p.first_name || ' ' || p.last_name as Full_name, b.branch_name
from Books as b
JOIN Loans as l
ON l.book_id = b.book_id
JOIN Patrons as p
ON l.patron_id = p.patron_id
JOIN Branches as b
ON l.branch_id = b.branch_id
WHERE genre_id = 1;

--Count the number of books in each genre category.
SELECT genre_id,
COUNT(*) as number_of_books 
from Books 
GROUP BY genre_id;

--Calculate the average, minimum, and maximum loan duration (days between checkout and return) for each library branch. Include only returned books.
SELECT 
    branch_id,
    AVG(JULIANDAY(return_date) - JULIANDAY(checkout_date)) AS avg_loan_duration,
    MIN(JULIANDAY(return_date) - JULIANDAY(checkout_date)) AS min_loan_duration,
    MAX(JULIANDAY(return_date) - JULIANDAY(checkout_date)) AS max_loan_duration
FROM 
    loans
WHERE 
    return_date IS NOT NULL  -- only include returned books
GROUP BY 
    branch_id;
    
--Find patrons with overdue books (due_date < CURRENT_DATE and return_date = ' '), along with the count of overdue books they have.
SELECT patron_id,
       COUNT(*) AS overdue_books
FROM loans
WHERE due_date < CURRENT_DATE
  AND (return_date IS NULL OR return_date = '')
GROUP BY patron_id
HAVING COUNT(*) > 0;

--Time-based analysis: Analyze monthly borrowing trends. Show the year, month, number of loans, and number of unique patrons for each month.
SELECT 
    strftime('%Y', checkout_date) AS year,
    strftime('%m', checkout_date) AS month,
    COUNT(*) AS total_loans,
    COUNT(DISTINCT patron_id) AS unique_patrons
FROM loans
GROUP BY 
    strftime('%Y', checkout_date),
    strftime('%m', checkout_date)
ORDER BY 
    year, month;
    
--Write a query to create a simple data dictionary for the library database schema, listing table names, column names, data types, and whether they are primary keys.
SELECT
    m.name AS table_name,
    p.name AS column_name,
    p.type AS data_type;
    
--In our library database, we track which branch a book was borrowed from, but books can exist at multiple branches. How would you modify the schema to track the actual inventory at each branch?
CREATE TABLE book_inventory (
    inventory_id INTEGER PRIMARY KEY,
    book_id INTEGER NOT NULL,
    branch_id INTEGER NOT NULL,
    copies_owned INTEGER NOT NULL,
    available_copies INTEGER NOT NULL,
    FOREIGN KEY (book_id) REFERENCES books(book_id),
    FOREIGN KEY (branch_id) REFERENCES branches(branch_id)
);

--Based on the provided data model, what business questions could library administrators answer using SQL queries that we haven't covered in our exercise?
/* Which books are under-stocked or over-stocked?
Which branches need more copies of specific books?
Which authors or genres dominate the collection?
Are there patrons who stopped borrowing?
Do certain patrons prefer certain genres or authors?
Which branches have the fastest turnover?
What books are becoming more popular over time?/*

--How would you extend this schema to track additional patron interactions, such as reserved books, late fees, or participation in library programs?
/* we sould not overload the old table instaed enter a new table for these queries, Maybe under the title "Reservations"
reservations (
    reservation_id PRIMARY KEY,
    patron_id,
    book_id,
    branch_id,
    reservation_date,
    FOREIGN KEY (patron_id) REFERENCES patrons(patron_id),
    FOREIGN KEY (book_id) REFERENCES books(book_id),
    FOREIGN KEY (branch_id) REFERENCES branches(branch_id)
)/*

--For tasks 1-3, how could you combine them into a single, more complex query that finds recent history books with multiple copies?
/*SELECT title, publication_year, copies_owned, genre_id
FROM books
WHERE publication_year > 2000
  AND copies_owned > 5
  AND genre_id = 1
  AND title LIKE '%History%'
ORDER BY publication_year DESC;/*

--What performance considerations should be kept in mind when running complex joins and aggregations on large library datasets?
/* When working with a big library database, slow queries can be a problem. To make them faster, put indexes
on important columns, filter data before joining tables, and only get the columns you need. Counting or
summing many rows can be slow, so it helps to pre-calculate totals. Searching with % in LIKE is also slow,
so use full-text search if possible./*